DELETE FROM calls;
DELETE FROM transactions;
DELETE FROM accounts;
DELETE FROM users;
DELETE FROM city;

ALTER SEQUENCE users_id_seq RESTART WITH 1;
ALTER SEQUENCE transactions_id_seq RESTART WITH 1;
ALTER SEQUENCE city_city_id_seq RESTART WITH 1;
ALTER SEQUENCE calls_call_id_seq RESTART WITH 1;

-- 1. Добавляем города с разной стоимостью звонков
INSERT INTO city (n_cost, d_cost) VALUES
(2.50, 2.00),  -- Местные звонки
(5.00, 4.00),  -- Городские звонки
(8.00, 6.50),  -- Междугородние
(12.00, 10.00), -- Дальнее соединение
(15.00, 12.00), -- Международные
(3.50, 3.00),  -- Мобильные местные
(6.50, 5.50),  -- Мобильные другие
(10.00, 8.50), -- Спец номера
(1.50, 1.20),  -- Эконом тариф
(20.00, 18.00); -- Премиум звонки

-- 2. Добавляем пользователей
INSERT INTO users (fio, inn, adress, legal_entity_name) VALUES
('Иванов Иван Иванович', '1234567890', 'Москва, ул. Ленина, 1', NULL),
('Петрова Анна Сергеевна', '2345678901', 'СПб, Невский пр-т, 25', NULL),
('Сидоров Михаил Петрович', '3456789012', 'Казань, ул. Баумана, 15', NULL),
('Козлова Елена Викторовна', '4567890123', 'Новосибирск, ул. Кирова, 8', NULL),
('ООО "ТелекомСервис"', '5678901234', 'Москва, ул. Тверская, 10', 'ООО "ТелекомСервис"'),
('АО "БизнесКонсалт"', '6789012345', 'Екатеринбург, пр-т Ленина, 50', 'АО "БизнесКонсалт"'),
('Николаев Дмитрий Олегович', '7890123456', 'Владивосток, ул. Светланская, 22', NULL),
('ИП Семенов А.В.', '8901234567', 'Краснодар, ул. Красная, 100', 'ИП Семенов А.В.'),
('Волкова Ольга Игоревна', '9012345678', 'Сочи, ул. Курортная, 5', NULL),
('ООО "СтальПроект"', '0123456789', 'Челябинск, ул. Металлургов, 30', 'ООО "СтальПроект"');

-- 3. Создаем счета для пользователей
INSERT INTO accounts (id, balance, debtor_status) VALUES
(1, 500.00, false),
(2, 300.00, false),
(3, 750.00, false),
(4, 200.00, false),
(5, 5000.00, false),
(6, 3000.00, false),
(7, 100.00, false),
(8, 1500.00, false),
(9, 400.00, false),
(10, 8000.00, false);

-- 4. Добавляем транзакции пополнения (соответствуют начальным балансам)
INSERT INTO transactions (account_id, amount, transaction_type, transaction_date) VALUES
(1, 500.00, 'income', '2024-01-01 10:00:00'),
(2, 300.00, 'income', '2024-01-01 11:00:00'),
(3, 750.00, 'income', '2024-01-01 12:00:00'),
(4, 200.00, 'income', '2024-01-02 09:00:00'),
(5, 5000.00, 'income', '2024-01-02 10:00:00'),
(6, 3000.00, 'income', '2024-01-02 11:00:00'),
(7, 100.00, 'income', '2024-01-03 08:00:00'),
(8, 1500.00, 'income', '2024-01-03 09:00:00'),
(9, 400.00, 'income', '2024-01-03 10:00:00'),
(10, 8000.00, 'income', '2024-01-03 11:00:00');

-- 5. Добавляем звонки с расчетом стоимости
INSERT INTO calls (user_id, city_id, call_date, duration) VALUES
-- Иванов
(1, 1, '2024-01-10 09:05:00', '15 minutes'),  -- 15 * 2.50 = 37.50
(1, 2, '2024-01-10 14:20:00', '8 minutes'),   -- 8 * 5.00 = 40.00

-- Петрова
(2, 3, '2024-01-10 11:30:00', '25 minutes'),  -- 25 * 8.00 = 200.00
(2, 4, '2024-01-11 16:45:00', '12 minutes'),  -- 12 * 12.00 = 144.00

-- Сидоров
(3, 5, '2024-01-11 10:15:00', '30 minutes'),  -- 30 * 15.00 = 450.00
(3, 6, '2024-01-12 13:20:00', '18 minutes'),  -- 18 * 3.50 = 63.00

-- Козлова
(4, 9, '2024-01-12 15:30:00', '40 minutes'),  -- 40 * 1.50 = 60.00
(4, 1, '2024-01-13 17:25:00', '22 minutes'),  -- 22 * 2.50 = 55.00

-- ООО "ТелекомСервис"
(5, 7, '2024-01-13 09:00:00', '45 minutes'),  -- 45 * 6.50 = 292.50
(5, 8, '2024-01-14 11:30:00', '60 minutes'),  -- 60 * 10.00 = 600.00

-- АО "БизнесКонсалт" 
(6, 10, '2024-01-14 14:00:00', '20 minutes'), -- 20 * 20.00 = 400.00
(6, 5, '2024-01-15 16:20:00', '35 minutes'),  -- 35 * 15.00 = 525.00

-- Николаев 
(7, 2, '2024-01-15 18:10:00', '5 minutes'),   -- 5 * 5.00 = 25.00
(7, 3, '2024-01-16 20:30:00', '7 minutes'),   -- 7 * 8.00 = 56.00

-- ИП Семенов 
(8, 4, '2024-01-16 08:45:00', '90 minutes'),  -- 90 * 12.00 = 1080.00
(8, 6, '2024-01-17 12:15:00', '28 minutes'),  -- 28 * 3.50 = 98.00

-- Волкова 
(9, 1, '2024-01-17 19:00:00', '32 minutes'),  -- 32 * 2.50 = 80.00
(9, 9, '2024-01-18 21:15:00', '15 minutes'),  -- 15 * 1.50 = 22.50

-- ООО "СтальПроект"
(10, 8, '2024-01-18 10:30:00', '120 minutes'),-- 120 * 10.00 = 1200.00
(10, 7, '2024-01-19 15:45:00', '45 minutes'); -- 45 * 6.50 = 292.50

-- 6. Добавляем транзакции списаний за звонки (точно рассчитанные)
INSERT INTO transactions (account_id, amount, transaction_type, transaction_date) VALUES
-- Списания за звонки Иванова
(1, 37.50, 'expense', '2024-01-10 09:20:00'),
(1, 40.00, 'expense', '2024-01-10 14:28:00'),

-- Списания за звонки Петровой
(2, 200.00, 'expense', '2024-01-10 11:55:00'),
(2, 144.00, 'expense', '2024-01-11 16:57:00'),

-- Списания за звонки Сидорова
(3, 450.00, 'expense', '2024-01-11 10:45:00'),
(3, 63.00, 'expense', '2024-01-12 13:38:00'),

-- Списания за звонки Козловой
(4, 60.00, 'expense', '2024-01-12 16:10:00'),
(4, 55.00, 'expense', '2024-01-13 17:47:00'),

-- Списания за звонки ООО "ТелекомСервис"
(5, 292.50, 'expense', '2024-01-13 09:45:00'),
(5, 600.00, 'expense', '2024-01-14 12:30:00'),

-- Списания за звонки АО "БизнесКонсалт"
(6, 400.00, 'expense', '2024-01-14 14:20:00'),
(6, 525.00, 'expense', '2024-01-15 16:55:00'),

-- Списания за звонки Николаева
(7, 25.00, 'expense', '2024-01-15 18:15:00'),
(7, 56.00, 'expense', '2024-01-16 20:37:00'),

-- Списания за звонки ИП Семенова
(8, 1080.00, 'expense', '2024-01-16 10:15:00'),
(8, 98.00, 'expense', '2024-01-17 12:43:00'),

-- Списания за звонки Волковой
(9, 80.00, 'expense', '2024-01-17 19:32:00'),
(9, 22.50, 'expense', '2024-01-18 21:30:00'),

-- Списания за звонки ООО "СтальПроект"
(10, 1200.00, 'expense', '2024-01-18 12:30:00'),
(10, 292.50, 'expense', '2024-01-19 16:30:00');

-- 7. Обновляем балансы на основе всех транзакций
UPDATE accounts SET balance = (
  SELECT COALESCE(SUM(CASE WHEN transaction_type = 'income' THEN amount ELSE -amount END), 0)
  FROM transactions 
  WHERE transactions.account_id = accounts.id
);

-- 8. Обновляем статус должников (баланс < 0)
UPDATE accounts SET debtor_status = (balance < 0);

SELECT * from users;
SELECT * from accounts;
SELECT * from transactions;
SELECT * from calls;